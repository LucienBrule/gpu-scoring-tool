# TASK.daemon.define-api-surface.md

## ðŸ§© Task: Define the API Surface for `glyphd`

Junie, your task is to define and scaffold the REST API interface for the `glyphd` FastAPI backend. This service will expose structured access to scored GPU data, GPU model metadata, and insights derived from the pipeline.

---

## ðŸŽ¯ Objectives

Implement API routes in FastAPI that expose the following:

### ðŸ”¹ `GET /api/health`
- Return simple health check.
- Response: `{ "status": "ok" }`

### ðŸ”¹ `GET /api/listings`
- Return all known listing records from the latest pipeline output (e.g. deduped + scored CSV).
- Response: `List[GPUListingDTO]` (define this DTO).
- Must support optional filters via query params:
  - `model` â†’ exact match of known model enum
  - `quantized` â†’ filter by quantization capability

### ðŸ”¹ `GET /api/models`
- Return GPU model metadata from the current model spec file (e.g. `Final_Market_Value_GPU_Summary.csv` or equivalent YAML).
- Response: `List[GPUModelDTO]`

### ðŸ”¹ `GET /api/report`
- Return the rendered insight report generated by the pipeline (`insight.md`, parsed or raw).
- Response: `ReportDTO`, including:
  - `markdown: str`
  - `summary_stats: dict`
  - `top_ranked: List[str]`
  - `scoring_weights: dict`

---

## âœ¨ Requirements

- All DTOs must use Pydantic v2 models.
- Must define `api.router` module and register routes in app.
- Responses must include FastAPI tags and descriptions for OpenAPI.
- Each endpoint must be documented with `response_model` and HTTP status.
- Include meaningful typing and docstrings.

---

## ðŸ§ª Completion Criteria

- FastAPI app returns proper JSON responses on all defined routes.
- DTOs validate against real pipeline sample output.
- `GET /openapi.json` reflects the correct schema.
- Future integrations (e.g., OpenAPI SDK generation) are possible with no refactoring.

---

## ðŸ’¡ Notes

You may assume the glyphsieve scoring output is available in a preloaded file or in-memory cache for now. Actual DB or streaming logic will be handled later.

This task sets up all surface access for the `glyphd` API. Your implementation must be clean, typed, and extensible.

---

## âœ… Task Completion Summary

This task has been completed successfully. The following work was done:

1. Created Pydantic v2 DTO models:
   - `GPUListingDTO` for GPU listing information
   - `GPUModelDTO` for GPU model metadata
   - `ReportDTO` for market insight reports

2. Implemented API endpoints:
   - `GET /api/health` for health check
   - `GET /api/listings` for GPU listings with filtering by model and quantization capability
   - `GET /api/models` for GPU model metadata
   - `GET /api/report` for market insight reports

3. Ensured all endpoints are properly documented with:
   - Response models
   - HTTP status codes
   - Tags for OpenAPI grouping
   - Detailed descriptions

4. Implemented data loading from sample files:
   - GPU listings from `scored_sample.csv`
   - GPU model metadata from `Final_Market_Value_GPU_Summary.csv` and `gpu_specs.yaml`
   - Market insight reports from `reports/*/insight.md`
   - Scoring weights from `scoring_weights.yaml`

5. Added comprehensive tests to verify the API functionality:
   - Tests for endpoint registration
   - Tests for response structure
   - Tests for filtering capabilities

All tests pass successfully, and the implementation meets all the completion criteria. The API is now ready for integration with the frontend and can be extended with additional functionality in the future.