

# TASK.web.reports-view.md

## Title
Implement Web UI to Browse GPU Insight Reports

## Category
web

## Status
open

## Purpose
Enable users to view and explore GPU pricing insight reports generated by the `glyphsieve` pipeline directly from the web UI. This view will serve as the operator's high-level window into recent market data, scores, quantization estimates, and tags.

## Requirements

1. **Create a Page in `controlpanel`**
   - Route: `/reports`
   - Title: "Insight Reports"
   - Must be listed in the app navigation.

2. **Render Insight Table**
   - Table view of the most recently scored and enriched listings.
   - Columns must include: `model`, `price_usd`, `score`, `quantization_capacity`, `seen_at`, and all heuristics applied.
   - Support column sorting and horizontal scrolling if needed.

3. **Fetch Report from `glyphd`**
   - REST endpoint: `GET /api/reports/latest`
   - Assume this returns a full JSON report matching the latest scored data.
   - If the report is missing or empty, display a placeholder and guidance message.

4. **Visual Indicators**
   - Score must be color-coded or badge-labeled (e.g. green/yellow/red).
   - Quantization capacity must be visualized with chip icons, tag badges, or numeric indicators.

5. **Data Freshness Display**
   - Include timestamp of latest report (from `seen_at`)
   - Show “Last updated: {relative time}” using `dayjs` or similar.

6. **Filtering**
   - Add dropdowns or multiselect filters for:
     - `model`
     - `region`
     - `MIG capable` (boolean)

7. **Pagination**
   - Paginate results with limit of 25 rows per page.
   - Pagination should be server-side if `glyphd` supports it, otherwise client-side.

8. **Accessibility + Responsiveness**
   - Must work on mobile and tablets
   - Use semantic HTML table with accessible labels and headings

## Tests
- Add an end-to-end integration test to `tests/integration/reports.spec.ts`
- Tests must:
  - Load `/reports` with a live `glyphd` instance running
  - Assert presence of at least one scored listing
  - Validate that pagination, filtering, and UI error states all function properly
  - No mocking is permitted — tests must exercise the full stack

## DX Runbook
```bash
# Start full stack (must be running)
docker compose up -d --build

# Regenerate TypeScript client (required if API changed)
cd web
pnpm run pnpm codegen

# Run end-to-end tests
pnpm run test --filter controlpanel

# Optional: run component unit tests for faster feedback while developing
# Component tests should live in src/app/reports/__tests__
```

## Integration Requirements
- You must use the **manual wrapper client** in `@repo/client` to call glyphd.
- Do **not** call the code-generated API directly — all access must go through the wrapper.
- All changes must follow TDD: write or update tests before running dev server.
- You must never start the dev server manually.
- All development and testing must use end-to-end tests or component tests in a CI-safe, non-interactive environment.

## Completion Criteria
- `/reports` route exists and renders live data from `glyphd`
- All columns are present and formatted correctly
- Filtering and pagination work
- Page is responsive and accessible
- All tests pass and app builds without warnings